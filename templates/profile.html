{% extends 'base.html' %}
{% load static %}

{% block title %}Hồ sơ của bạn{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/profile_style.css' %}">
{% endblock %}

{% block content %}
<div class="profile-page">
    <section class="profile-hero">
        <div class="hero-summary">
            <div class="profile-avatar">{{ user.profile.full_name|default:user.username|first|upper }}</div>
            <h1>Xin chào, {{ user.profile.full_name|default:user.username }}</h1>
            <p>Quản lý thông tin cá nhân, cập nhật mật khẩu và theo dõi những hoạt động gần đây của bạn trong Rita.</p>
        </div>
        <aside class="hero-stats">
            <h2>Thông tin nhanh</h2>
            <div class="stat-list">
                <span>📧 {{ user.email }}</span>
                <span>🆔 Tên đăng nhập: {{ user.username }}</span>
                <span>🗓 Thành viên từ: {{ user.date_joined|date:"d/m/Y" }}</span>
            </div>
        </aside>
    </section>

    {% if messages %}
    <div class="alerts">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <section class="profile-forms">
        <article class="profile-card">
            <header>
                <h2>Thông tin cá nhân</h2>
                <button id="edit-profile-btn" type="button" class="profile-toggle">
                    <span>Chỉnh sửa</span>
                </button>
            </header>

            <div id="view-profile-info" class="profile-info">
                <div class="info-field">
                    <span>Họ và tên</span>
                    <strong>{{ user.profile.full_name|default:"Chưa cập nhật" }}</strong>
                </div>
                <div class="info-field">
                    <span>Ngày sinh</span>
                    <strong>{{ user.profile.date_of_birth|date:"d/m/Y"|default:"Chưa cập nhật" }}</strong>
                </div>
                <div class="info-field">
                    <span>Email</span>
                    <strong>{{ user.email }}</strong>
                </div>
            </div>

            <form id="edit-profile-form" method="post" action="{% url 'core:profile_view' %}" class="hidden">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="update_profile">
                {{ profile_form.as_p }}
                <div class="form-actions">
                    <button type="button" id="cancel-edit-btn" class="btn-secondary">Huỷ</button>
                    <button type="submit" class="btn-primary">Lưu thay đổi</button>
                </div>
            </form>
        </article>

        <article class="profile-card">
            <header>
                <h2>Đổi mật khẩu</h2>
            </header>
            <form method="post" action="{% url 'core:profile_view' %}">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="change_password">
                {{ password_form.as_p }}
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Đổi mật khẩu</button>
                </div>
            </form>
        </article>
    </section>
</div>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/profile.js' %}"></script>
{% endblock %}
