{% extends 'base.html' %}
{% load static %}

{% block title %}Web Scraper - Rita AI Suite{% endblock %}

{% block extra_css %}
    <style>
        body {
            overflow: auto;
        }
        .app-container {
            padding: 1.5rem;
            min-height: 100vh;
        }
        .main-content {
            padding: 0;
        }
        .scraper-page {
            display: flex;
            flex-direction: column;
            gap: 1.75rem;
        }
        .tool-hero {
            display: flex;
            gap: 2.4rem;
            align-items: stretch;
            padding: 2.4rem;
            border-radius: 28px;
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.95), rgba(12, 14, 24, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            overflow: hidden;
            box-shadow: 0 30px 80px rgba(5, 8, 20, 0.55);
        }
        .tool-hero::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(79, 209, 197, 0.28), transparent 55%),
                        radial-gradient(circle at bottom left, rgba(104, 211, 145, 0.18), transparent 60%);
            pointer-events: none;
        }
        .hero-copy {
            position: relative;
            z-index: 1;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.15rem;
        }
        .hero-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0.85rem;
            border-radius: 999px;
            background: rgba(104, 211, 145, 0.12);
            color: var(--primary-color);
            font-size: 0.85rem;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            width: fit-content;
        }
        .hero-copy h1 {
            font-size: 2.45rem;
            font-weight: 600;
            line-height: 1.2;
            color: var(--text-primary);
            margin: 0;
        }
        .hero-copy p {
            color: var(--text-secondary);
            line-height: 1.7;
            max-width: 560px;
        }
        .hero-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .metric-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.55rem;
            padding: 0.55rem 0.95rem;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        .hero-card {
            position: relative;
            z-index: 1;
            width: 320px;
            padding: 1.85rem;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(10, 12, 20, 0.68);
            backdrop-filter: blur(14px);
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
        .hero-card .hero-icon {
            width: 56px;
            height: 56px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(104, 211, 145, 0.35), rgba(79, 209, 197, 0.32));
            border: 1px solid rgba(104, 211, 145, 0.35);
        }
        .hero-card ul {
            margin: 0;
            padding: 0;
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.85rem;
            color: var(--text-secondary);
        }
        .hero-card li strong {
            color: var(--text-primary);
        }
        .scraper-grid {
            display: grid;
            grid-template-columns: minmax(0, 360px) minmax(0, 1fr);
            gap: 1.5rem;
        }
        .glass-card {
            background: rgba(12, 14, 24, 0.78);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 28px 60px rgba(5, 8, 20, 0.4);
            backdrop-filter: blur(12px);
            padding: 2rem 2.2rem;
        }
        .control-stack {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }
        .control-card {
            position: relative;
        }
        .control-card h3 {
            margin: 0 0 1.5rem;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .card-subtitle {
            margin: 0 0 1.75rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.55rem;
            margin-bottom: 1.2rem;
        }
        .form-group label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.85rem 1.1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 14px;
            color: var(--text-primary);
            transition: var(--transition-smooth);
        }
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(104, 211, 145, 0.18);
        }
        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23a0a0d0' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
        }
        .tags-input-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.45rem;
            padding: 0.65rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 14px;
        }
        .tags-input-container input {
            flex: 1;
            min-width: 160px;
            border: none;
            background: transparent;
            color: var(--text-primary);
            padding: 0.45rem;
            outline: none;
        }
        .tag-item {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.7rem;
            border-radius: 12px;
            background: rgba(104, 211, 145, 0.15);
            color: var(--primary-color);
            font-size: 0.85rem;
        }
        .tag-remove {
            cursor: pointer;
            color: var(--text-secondary);
        }
        .tag-remove:hover {
            color: var(--error-color);
        }
        .btn-primary,
        .btn-secondary,
        .btn-danger {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.45rem;
            border-radius: 14px;
            border: 1px solid transparent;
            padding: 0.75rem 1.4rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        .btn-primary {
            background: linear-gradient(135deg, #68d391 0%, #4fd1c5 100%);
            color: #0b0c12;
            box-shadow: 0 18px 40px rgba(79, 209, 197, 0.35);
        }
        .btn-primary:hover {
            filter: brightness(1.05);
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            border-color: rgba(255, 255, 255, 0.12);
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.14);
        }
        .btn-danger {
            background: rgba(248, 113, 113, 0.15);
            color: #fca5a5;
            border-color: rgba(248, 113, 113, 0.4);
        }
        .btn-danger:hover {
            background: rgba(248, 113, 113, 0.25);
        }
        .result-card {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        #results-placeholder,
        #results-output,
        #loading-indicator {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 1.75rem;
        }
        #results-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 220px;
            color: var(--text-secondary);
        }
        #loading-indicator {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            color: var(--text-secondary);
        }
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #results-output {
            display: none;
            gap: 1.25rem;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        .result-header h3 {
            margin: 0;
            font-size: 1.3rem;
            color: var(--text-primary);
        }
        .download-buttons {
            display: inline-flex;
            gap: 0.75rem;
        }
        .table-container {
            background: rgba(12, 14, 24, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            max-height: 360px;
            overflow: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th,
        td {
            padding: 0.85rem 1.1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }
        thead {
            background: rgba(79, 209, 197, 0.08);
            color: var(--primary-color);
            position: sticky;
            top: 0;
            z-index: 1;
        }
        tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        .history-section {
            background: rgba(12, 14, 24, 0.78);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 28px 60px rgba(5, 8, 20, 0.4);
            backdrop-filter: blur(12px);
            padding: 2rem 2.25rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        .history-header h2 {
            margin: 0;
            font-size: 1.4rem;
            color: var(--text-primary);
        }
        #history-table tbody tr td:first-child {
            color: var(--text-secondary);
        }
        #history-table tbody tr td:nth-child(2) {
            max-width: 320px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.65rem;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-badge.complete { background: rgba(104, 211, 145, 0.15); color: var(--primary-color); }
        .status-badge.processing { background: rgba(250, 204, 21, 0.15); color: #facc15; }
        .status-badge.pending { background: rgba(148, 163, 184, 0.2); color: #cbd5f5; }
        .status-badge.failed { background: rgba(248, 113, 113, 0.18); color: #fca5a5; }
        .usage-card p {
            margin: 0.35rem 0;
            color: var(--text-secondary);
        }
        .site-footer {
            text-align: center;
            font-size: 0.75rem;
            opacity: 0.6;
            padding-top: 1.75rem;
        }
        @media (max-width: 1024px) {
            .tool-hero {
                flex-direction: column;
            }
            .hero-card {
                width: 100%;
            }
            .scraper-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }
            .tool-hero {
                padding: 2rem;
            }
            .glass-card,
            .history-section {
                padding: 1.6rem 1.8rem;
            }
        }
    </style>
{% endblock %}

{% block content %}
<div class="scraper-page">
    <section class="tool-hero">
        <div class="hero-copy">
            <span class="hero-eyebrow">
                <span>üåê</span>
                Web Scraper
            </span>
            <h1>Tr√≠ch xu·∫•t d·ªØ li·ªáu web v·ªõi Rita nhanh v√† chu·∫©n</h1>
            <p>Nh·∫≠p URL, ch·ªçn tr∆∞·ªùng c·∫ßn l·∫•y v√† ƒë·ªÉ Rita gom d·ªØ li·ªáu s·∫°ch, hi·ªÉn th·ªã b·∫£ng k·∫øt qu·∫£, s·∫µn s√†ng t·∫£i v·ªÅ JSON ho·∫∑c CSV.</p>
            <div class="hero-metrics">
                <span class="metric-chip">‚ö° Theo d√µi ti·∫øn tr√¨nh realtime</span>
                <span class="metric-chip">üß† AI t·ªëi ∆∞u d·ªØ li·ªáu</span>
                <span class="metric-chip">üì• Xu·∫•t JSON/CSV m·ªôt ch·∫°m</span>
            </div>
        </div>
        <aside class="hero-card">
            <div class="hero-icon">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4H20V20H4V4Z" stroke="#68d391" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M4 10H20" stroke="#68d391" stroke-width="2" stroke-linecap="round"/>
                    <path d="M10 4V20" stroke="#68d391" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>
            <ul>
                <li><strong>Kh√¥ng c·∫ßn code:</strong> ƒêi·ªÅn URL v√† tr∆∞·ªùng c·∫ßn l·∫•y, Rita t·ª± ƒë·ªông l√†m ph·∫ßn c√≤n l·∫°i.</li>
                <li><strong>Qu·∫£n l√Ω chi ph√≠:</strong> Theo d√µi token v√† chi ph√≠ ngay trong b·∫£ng ƒëi·ªÅu khi·ªÉn.</li>
                <li><strong>L·ªãch s·ª≠ r√µ r√†ng:</strong> L∆∞u log m·ªói l·∫ßn scrape ƒë·ªÉ t√°i s·ª≠ d·ª•ng ho·∫∑c xo√° khi c·∫ßn.</li>
            </ul>
        </aside>
    </section>

    <div class="scraper-grid">
        <div class="control-stack">
            <div class="glass-card control-card">
                <h3>C·∫•u h√¨nh thu th·∫≠p</h3>
                <p class="card-subtitle">ƒêi·ªÅn URL, th√™m c√°c tr∆∞·ªùng d·ªØ li·ªáu mong mu·ªën r·ªìi b·∫Øt ƒë·∫ßu ƒë·ªÉ Rita th·ª±c thi.</p>
                <form id="scrape-form">
                    <div class="form-group">
                        <label for="url-input">URL trang web</label>
                        <input type="url" id="url-input" placeholder="https://example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="fields-input">C√°c tr∆∞·ªùng c·∫ßn l·∫•y</label>
                        <div id="tags-input-container" class="tags-input-container">
                            <input type="text" id="fields-input" placeholder="Nh·∫≠p tr∆∞·ªùng r·ªìi nh·∫•n Enter...">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="model-selection">M√¥ h√¨nh AI</label>
                        <select id="model-selection">
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        </select>
                    </div>
                    <button type="submit" id="start-scrape-btn" class="btn-primary">B·∫Øt ƒë·∫ßu tr√≠ch xu·∫•t</button>
                </form>
            </div>

            <div id="usage-card" class="glass-card control-card usage-card" style="display: none;">
                <h3>Chi ph√≠ & Token</h3>
                <p>Input Tokens: <span id="input-tokens">0</span></p>
                <p>Output Tokens: <span id="output-tokens">0</span></p>
                <p>T·ªïng chi ph√≠ (∆∞·ªõc t√≠nh): <span id="total-cost">$0.0000</span></p>
            </div>
        </div>

        <div class="glass-card result-card">
            <div id="results-placeholder">
                <p>K·∫øt qu·∫£ s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y sau khi qu√° tr√¨nh ho√†n t·∫•t.</p>
            </div>
            <div id="loading-indicator">
                <div class="spinner"></div>
                <p>ƒêang x·ª≠ l√Ω, vui l√≤ng ch·ªù...</p>
            </div>
            <div id="results-output">
                <div class="result-header">
                    <h3>K·∫øt qu·∫£ tr√≠ch xu·∫•t</h3>
                    <div class="download-buttons">
                        <button id="download-json-btn" class="btn-secondary">T·∫£i JSON</button>
                        <button id="download-csv-btn" class="btn-secondary">T·∫£i CSV</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="results-table">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="history-section">
        <div class="history-header">
            <h2>L·ªãch s·ª≠ tr√≠ch xu·∫•t</h2>
            <button id="delete-history-btn" class="btn-danger">Xo√° l·ªãch s·ª≠</button>
        </div>
        <div class="table-container">
            <table id="history-table">
                <thead>
                    <tr>
                        <th>Ng√†y</th>
                        <th>URL</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<footer class="site-footer">
    <p>Rita c√≥ th·ªÉ m·∫Øc l·ªói, h√£y ki·ªÉm tra d·ªØ li·ªáu quan tr·ªçng tr∆∞·ªõc khi s·ª≠ d·ª•ng.</p>
</footer>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/scraper_script.js' %}"></script>
{% endblock %}
